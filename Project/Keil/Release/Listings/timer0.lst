C51 COMPILER V9.60.7.0   TIMER0                                                            06/23/2025 08:48:04 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Release\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\Hardware\timer0.c OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) INCDI
                    -R(..\..\Libraries\Include;..\..\User;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer0.lst)
                    - OBJECT(.\Release\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          
   3          #include "ir_handle.h"
   4          
   5          void timer0_config(void)
   6          {
   7   1          __EnableIRQ(TMR0_IRQn); // ä½¿èƒ½timer0ä¸­æ–­
   8   1          IE_EA = 1;              // ä½¿èƒ½æ€»ä¸­æ–­
   9   1      
  10   1          // è®¾ç½®timer0çš„è®¡æ•°åŠŸèƒ½ï¼Œé…ç½®ä¸€ä¸ªé¢‘ç‡ä¸º1kHzçš„ä¸­æ–­
  11   1          TMR_ALLCON = TMR0_CNT_CLR(0x1);                               // æ¸…é™¤è®¡æ•°å€¼
  12   1          TMR0_PRH = TMR_PERIOD_VAL_H((TIMER0_PERIOD_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  13   1          TMR0_PRL = TMR_PERIOD_VAL_L((TIMER0_PERIOD_VAL >> 0) & 0xFF);
  14   1          TMR0_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // è®¡æ•°ç­‰äºå‘¨æœŸæ—¶å
             -…è®¸å‘ç”Ÿä¸­æ–­
  15   1          TMR0_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // é€‰æ‹©ç³»ç»Ÿæ—¶é’Ÿï¼Œ1
             -28åˆ†é¢‘ï¼Œè®¡æ•°æ¨¡å¼
  16   1      }
  17          
  18          void TIMR0_IRQHandler(void) interrupt TMR0_IRQn
  19          {
  20   1          // è¿›å…¥ä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
  21   1          __IRQnIPnPush(TMR0_IRQn);
  22   1      
  23   1          // ---------------- ç”¨æˆ·å‡½æ•°å¤„ç† -------------------
  24   1      
  25   1          // å‘¨æœŸä¸­æ–­
  26   1          if (TMR0_CONH & TMR_PRD_PND(0x1))
  27   1          {
  28   2              TMR0_CONH |= TMR_PRD_PND(0x1); // æ¸…é™¤pending
  29   2      
  30   2      #if 1     // çº¢å¤–è§£ç ã€éœ€è¦æ”¾åˆ°100usçš„å®šæ—¶å™¨ä¸­æ–­æ¥å¤„ç†ã€‘
  31   2              { // çº¢å¤–è§£ç 
  32   3                  // static volatile u8 ir_fliter;
  33   3                  static volatile u16 ir_level_cnt; // çº¢å¤–ä¿¡å·çš„ä¸‹é™æ²¿æ—¶é—´é—´éš”è®¡æ•°
  34   3                  static volatile u32 __ir_data;    // 
  35   3                  static volatile bit last_level_in_ir_pin = 0;
  36   3                  // static volatile u16 ir_long_press_cnt; // æª¢æ¸¬ç´…å¤–é™æ§é•·æŒ‰çš„è¨ˆæ•¸å€¼
  37   3      
  38   3                  // å¯¹æ¯ä¸ªä¸‹é™æ²¿è¿›è¡Œè®¡æ•°
  39   3                  if (ir_level_cnt <= 1300)
  40   3                      ir_level_cnt++;
  41   3      
  42   3                  // æ»¤æ³¢æ“ä½œ
  43   3                  // ir_fliter <<= 1;
  44   3                  // if (IR_RECV_PIN)
  45   3                  // {
  46   3                  //     ir_fliter |= 1;
  47   3                  // }
  48   3                  // ir_fliter &= 0x07;
  49   3      
  50   3                  // if (ir_fliter == 0x07)
  51   3                  //     filter_level = 1;
C51 COMPILER V9.60.7.0   TIMER0                                                            06/23/2025 08:48:04 PAGE 2   

  52   3                  // else if (ir_fliter == 0x00)
  53   3                  //     filter_level = 0;
  54   3      
  55   3                  // if (filter_level)
  56   3                  if (IR_RECV_PIN)
  57   3                  {
  58   4                      last_level_in_ir_pin = 1; // è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ˜¯é«˜ç”µå¹³
  59   4      
  60   4                      // å¦‚æœä¹‹å‰ä¹Ÿæ˜¯é«˜ç”µå¹³
  61   4                      if (ir_level_cnt > 1200) // è¶…æ—¶æ—¶é—´(120000us,120ms)
  62   4                      {
  63   5                          // if (__ir_data != 0) // è¶…æ—¶ï¼Œä¸”æ¥æ”¶åˆ°æ•°æ®(çº¢å¤–æ¥æ”¶å¤„ç†å‡½æ•°ä¸­ä¼šæŠ
             -Šir_dataæ¸…é›¶)
  64   5                          if (__ir_data != 0) // è¶…æ—¶ï¼Œä¸”æ¥æ”¶åˆ°æ•°æ®(ç°åœ¨æ˜¯åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­æŠ
             -Š__ir_dataè‡ªåŠ¨æ¸…é›¶)
  65   5                          {
  66   6                              // // å¸¦æ ¡éªŒçš„ç‰ˆæœ¬ï¼š
  67   6                              // if ((u8)(__ir_data >> 8) == (u8)(~__ir_data)) // å¦‚æœé”®å€¼çš„åŸç å’Œåç 
             -ç›¸ç­‰
  68   6                              // {
  69   6                              // flag_is_recved_data = 1;
  70   6                              // }
  71   6      
  72   6                              // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
  73   6                              if (0 == flag_is_recved_data)
  74   6                              {
  75   7                                  // if ((__ir_data & 0xFF0000) == 0xFF0000)
  76   7                                  {
  77   8                                      ir_data = ~__ir_data;
  78   8                                      __ir_data = 0;
  79   8                                      flag_is_recved_data = 1;
  80   8                                  }
  81   7                              }
  82   6                          }
  83   5      
  84   5                          flag_is_recv_ir_repeat_code = 0; // è®¤ä¸ºé¥æ§å™¨æŒ‰é”®å·²ç»æŒ‰ä¸‹ï¼Œç„¶åæ¾å¼€
  85   5                      }
  86   4                  }
  87   3                  else
  88   3                  {
  89   4                      if (last_level_in_ir_pin)
  90   4                      {
  91   5                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æ˜¯é«˜ç”µå¹³ï¼Œç°åœ¨æ£€æµ‹åˆ°äº†ä½ç”µå¹³
  92   5                          if (ir_level_cnt <= 8) // å°äº800usï¼Œè¯´æ˜æ¥æ”¶åˆ°æ— æ•ˆçš„æ•°æ®ï¼Œé‡æ–°æ¥æ”¶
  93   5                          {
  94   6                              // FLAG_IS_RECVED_ERR_IR_DATA = 1;
  95   6                              flag_is_recv_ir_repeat_code = 0;
  96   6                          }
  97   5                          else if (ir_level_cnt <= 18) // å°äº1800us,è¯´æ˜æ¥æ”¶åˆ°äº†é€»è¾‘0
  98   5                          {
  99   6                              __ir_data <<= 1;
 100   6      
 101   6                              // P15D = 0; // æµ‹è¯•çº¢å¤–è§£ç 
 102   6                              // P15D = ~P15D; // æµ‹è¯•çº¢å¤–è§£ç 
 103   6                          }
 104   5                          else if (ir_level_cnt <= 26) // å°äº2600us,è¯´æ˜æ¥æ”¶åˆ°äº†é€»è¾‘1
 105   5                          {
 106   6                              __ir_data <<= 1;
 107   6                              __ir_data |= 0x01;
 108   6      
 109   6                              // P15D = 1; // æµ‹è¯•çº¢å¤–è§£ç 
 110   6                          }
C51 COMPILER V9.60.7.0   TIMER0                                                            06/23/2025 08:48:04 PAGE 3   

 111   5                          else if (ir_level_cnt <= 150) // å°äº15000us,è¯´æ˜æ¥æ”¶åˆ°äº†æ ¼å¼å¤´
 112   5                          {
 113   6                              // FLAG_IS_RECVED_ERR_IR_DATA = 1;
 114   6                              // ir_long_press_cnt = 0; // åŠ ä¸Šè¿™ä¸€æ¡ä¼šæ£€æµ‹ä¸åˆ°é•¿æŒ‰
 115   6                          }
 116   5                          else if (ir_level_cnt <= 420) // å°äº42ms,è¯´æ˜æ¥æ”¶å®Œä¸€æ¬¡å®Œæ•´çš„çº¢å¤–ä¿¡å·
 117   5                          {
 118   6      #if 0 // å¸¦æ ¡éªŒçš„ç‰ˆæœ¬ï¼Œå‘½ä»¤æºç ä¸å‘½ä»¤åç è¿›è¡Œæ ¡éªŒ
                  
                              if ((u8)(__ir_data >> 8) == (u8)(~__ir_data)) // å¦‚æœé”®å€¼çš„åŸç å’Œåç ç›¸ç­‰
                              {
                                  flag_is_recved_data = 1;
                                  flag_is_recv_ir_repeat_code = 1; //
                                  ir_long_press_cnt = 0;
                              }
              
              #else // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
 128   6      
 129   6                              if (0 == flag_is_recved_data) // å¦‚æœä¹‹å‰æœªæ¥æ”¶åˆ°æ•°æ®/æ¥æ”¶åˆ°çš„æ•°æ®
             -å·²ç»å¤„ç†å®Œæ¯•
 130   6                              {
 131   7                                  // if ((__ir_data & 0xFF0000) == 0xFF0000)
 132   7                                  {
 133   8                                      ir_data = ~__ir_data;
 134   8                                      __ir_data = 0;
 135   8                                      flag_is_recved_data = 1;
 136   8                                      // flag_is_recv_ir_repeat_code = 1; //
 137   8                                  }
 138   7                              }
 139   6      
 140   6      #endif // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
 141   6                          }
 142   5                          else if (ir_level_cnt <= 1200) // å°äº120000,120ms,è¯´æ˜æ¥æ”¶åˆ°äº†é‡å¤ç 
 143   5                          {
 144   6                              // if (ir_long_press_cnt < 65535)
 145   6                              //     ir_long_press_cnt++;
 146   6      
 147   6                              flag_is_recv_ir_repeat_code = 1;
 148   6                          }
 149   5                          // else // è¶…è¿‡120000,è¯´æ˜æ¥æ”¶åˆ°æ— æ•ˆçš„æ•°æ®
 150   5                          // {
 151   5                          // }
 152   5      
 153   5                          ir_level_cnt = 0;
 154   5                      }
 155   4      
 156   4                      last_level_in_ir_pin = 0; // è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ˜¯ä½ç”µå¹³
 157   4                  }
 158   3              } // çº¢å¤–è§£ç 
 159   2      #endif // çº¢å¤–è§£ç ã€éœ€è¦æ”¾åˆ°100usçš„å®šæ—¶å™¨ä¸­æ–­æ¥å¤„ç†ã€‘
 160   2          }
 161   1      
 162   1          // é€€å‡ºä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
 163   1          __IRQnIPnPop(TMR0_IRQn);
 164   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    369    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   TIMER0                                                            06/23/2025 08:48:04 PAGE 4   

   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
