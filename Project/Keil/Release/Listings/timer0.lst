C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Release\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\Hardware\timer0.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C)
                    - INCDIR(..\..\Libraries\Include;..\..\User;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer
                    -0.lst) OBJECT(.\Release\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          
   3          #include "ir_handle.h"
   4          #include "user_config.h"
   5          
   6          void timer0_config(void)
   7          {
   8   1          __EnableIRQ(TMR0_IRQn); // ä½¿èƒ½timer0ä¸­æ–­
   9   1          IE_EA = 1;              // ä½¿èƒ½æ€»ä¸­æ–­
  10   1      
  11   1          // è®¾ç½®timer0çš„è®¡æ•°åŠŸèƒ½ï¼Œé…ç½®ä¸€ä¸ªé¢‘ç‡ä¸º1kHzçš„ä¸­æ–­
  12   1          TMR_ALLCON = TMR0_CNT_CLR(0x1);                               // æ¸…é™¤è®¡æ•°å€¼
  13   1          TMR0_PRH = TMR_PERIOD_VAL_H((TIMER0_PERIOD_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  14   1          TMR0_PRL = TMR_PERIOD_VAL_L((TIMER0_PERIOD_VAL >> 0) & 0xFF);
  15   1          TMR0_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // è®¡æ•°ç­‰äºå‘¨æœŸæ—¶å
             -…è®¸å‘ç”Ÿä¸­æ–­
  16   1          TMR0_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // é€‰æ‹©ç³»ç»Ÿæ—¶é’Ÿï¼Œ1
             -28åˆ†é¢‘ï¼Œè®¡æ•°æ¨¡å¼
  17   1      }
  18          
  19          void TIMR0_IRQHandler(void) interrupt TMR0_IRQn
  20          {
  21   1          // è¿›å…¥ä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
  22   1          __IRQnIPnPush(TMR0_IRQn);
  23   1      
  24   1          // ---------------- ç”¨æˆ·å‡½æ•°å¤„ç† -------------------
  25   1      
  26   1          // å‘¨æœŸä¸­æ–­
  27   1          if (TMR0_CONH & TMR_PRD_PND(0x1))
  28   1          {
  29   2              TMR0_CONH |= TMR_PRD_PND(0x1); // æ¸…é™¤pending
  30   2      
  31   2      #if 1     // çº¢å¤–è§£ç ã€éœ€è¦æ”¾åˆ°100usçš„å®šæ—¶å™¨ä¸­æ–­æ¥å¤„ç†ã€‘
  32   2              { // çº¢å¤–è§£ç 
  33   3                  // static volatile u8 ir_fliter;
  34   3                  static volatile u16 ir_level_cnt; // çº¢å¤–ä¿¡å·çš„ä¸‹é™æ²¿æ—¶é—´é—´éš”è®¡æ•°
  35   3                  static volatile u32 __ir_data;    //
  36   3                  static volatile bit last_level_in_ir_pin = 0;
  37   3                  // static volatile u16 ir_long_press_cnt; // æª¢æ¸¬ç´…å¤–é™æ§é•·æŒ‰çš„è¨ˆæ•¸å€¼
  38   3      
  39   3                  // å¯¹æ¯ä¸ªä¸‹é™æ²¿è¿›è¡Œè®¡æ•°
  40   3                  if (ir_level_cnt <= 1300)
  41   3                      ir_level_cnt++;
  42   3      
  43   3                  // æ»¤æ³¢æ“ä½œ
  44   3                  // ir_fliter <<= 1;
  45   3                  // if (IR_RECV_PIN)
  46   3                  // {
  47   3                  //     ir_fliter |= 1;
  48   3                  // }
  49   3                  // ir_fliter &= 0x07;
  50   3      
  51   3                  // if (ir_fliter == 0x07)
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 2   

  52   3                  //     filter_level = 1;
  53   3                  // else if (ir_fliter == 0x00)
  54   3                  //     filter_level = 0;
  55   3      
  56   3                  // if (filter_level)
  57   3                  if (IR_RECV_PIN)
  58   3                  {
  59   4                      last_level_in_ir_pin = 1; // è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ˜¯é«˜ç”µå¹³
  60   4      
  61   4                      // å¦‚æœä¹‹å‰ä¹Ÿæ˜¯é«˜ç”µå¹³
  62   4                      if (ir_level_cnt > 1200) // è¶…æ—¶æ—¶é—´(120000us,120ms)
  63   4                      {
  64   5                          // if (__ir_data != 0) // è¶…æ—¶ï¼Œä¸”æ¥æ”¶åˆ°æ•°æ®(çº¢å¤–æ¥æ”¶å¤„ç†å‡½æ•°ä¸­ä¼šæŠ
             -Šir_dataæ¸…é›¶)
  65   5                          if (__ir_data != 0) // è¶…æ—¶ï¼Œä¸”æ¥æ”¶åˆ°æ•°æ®(ç°åœ¨æ˜¯åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­æŠ
             -Š__ir_dataè‡ªåŠ¨æ¸…é›¶)
  66   5                          {
  67   6                              // // å¸¦æ ¡éªŒçš„ç‰ˆæœ¬ï¼š
  68   6                              // if ((u8)(__ir_data >> 8) == (u8)(~__ir_data)) // å¦‚æœé”®å€¼çš„åŸç å’Œåç 
             -ç›¸ç­‰
  69   6                              // {
  70   6                              // flag_is_recved_data = 1;
  71   6                              // }
  72   6      
  73   6                              // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
  74   6                              if (0 == flag_is_recved_data)
  75   6                              {
  76   7                                  // if ((__ir_data & 0xFF0000) == 0xFF0000)
  77   7                                  {
  78   8                                      ir_data = ~__ir_data;
  79   8                                      __ir_data = 0;
  80   8                                      flag_is_recved_data = 1;
  81   8                                  }
  82   7                              }
  83   6                          }
  84   5      
  85   5                          flag_is_recv_ir_repeat_code = 0; // è®¤ä¸ºé¥æ§å™¨æŒ‰é”®å·²ç»æŒ‰ä¸‹ï¼Œç„¶åæ¾å¼€
  86   5                      }
  87   4                  }
  88   3                  else
  89   3                  {
  90   4                      if (last_level_in_ir_pin)
  91   4                      {
  92   5                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æ˜¯é«˜ç”µå¹³ï¼Œç°åœ¨æ£€æµ‹åˆ°äº†ä½ç”µå¹³
  93   5                          if (ir_level_cnt <= 8) // å°äº800usï¼Œè¯´æ˜æ¥æ”¶åˆ°æ— æ•ˆçš„æ•°æ®ï¼Œé‡æ–°æ¥æ”¶
  94   5                          {
  95   6                              // FLAG_IS_RECVED_ERR_IR_DATA = 1;
  96   6                              flag_is_recv_ir_repeat_code = 0;
  97   6                          }
  98   5                          else if (ir_level_cnt <= 18) // å°äº1800us,è¯´æ˜æ¥æ”¶åˆ°äº†é€»è¾‘0
  99   5                          {
 100   6                              __ir_data <<= 1;
 101   6      
 102   6                              // P15D = 0; // æµ‹è¯•çº¢å¤–è§£ç 
 103   6                              // P15D = ~P15D; // æµ‹è¯•çº¢å¤–è§£ç 
 104   6                          }
 105   5                          else if (ir_level_cnt <= 26) // å°äº2600us,è¯´æ˜æ¥æ”¶åˆ°äº†é€»è¾‘1
 106   5                          {
 107   6                              __ir_data <<= 1;
 108   6                              __ir_data |= 0x01;
 109   6      
 110   6                              // P15D = 1; // æµ‹è¯•çº¢å¤–è§£ç 
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 3   

 111   6                          }
 112   5                          else if (ir_level_cnt <= 150) // å°äº15000us,è¯´æ˜æ¥æ”¶åˆ°äº†æ ¼å¼å¤´
 113   5                          {
 114   6                              // FLAG_IS_RECVED_ERR_IR_DATA = 1;
 115   6                              // ir_long_press_cnt = 0; // åŠ ä¸Šè¿™ä¸€æ¡ä¼šæ£€æµ‹ä¸åˆ°é•¿æŒ‰
 116   6                          }
 117   5                          else if (ir_level_cnt <= 420) // å°äº42ms,è¯´æ˜æ¥æ”¶å®Œä¸€æ¬¡å®Œæ•´çš„çº¢å¤–ä¿¡å·
 118   5                          {
 119   6      #if 0 // å¸¦æ ¡éªŒçš„ç‰ˆæœ¬ï¼Œå‘½ä»¤æºç ä¸å‘½ä»¤åç è¿›è¡Œæ ¡éªŒ
                  
                              if ((u8)(__ir_data >> 8) == (u8)(~__ir_data)) // å¦‚æœé”®å€¼çš„åŸç å’Œåç ç›¸ç­‰
                              {
                                  flag_is_recved_data = 1;
                                  flag_is_recv_ir_repeat_code = 1; //
                                  ir_long_press_cnt = 0;
                              }
              
              #else // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
 129   6      
 130   6                              if (0 == flag_is_recved_data) // å¦‚æœä¹‹å‰æœªæ¥æ”¶åˆ°æ•°æ®/æ¥æ”¶åˆ°çš„æ•°æ®
             -å·²ç»å¤„ç†å®Œæ¯•
 131   6                              {
 132   7                                  // if ((__ir_data & 0xFF0000) == 0xFF0000)
 133   7                                  {
 134   8                                      ir_data = ~__ir_data;
 135   8                                      __ir_data = 0;
 136   8                                      flag_is_recved_data = 1;
 137   8                                      // flag_is_recv_ir_repeat_code = 1; //
 138   8                                  }
 139   7                              }
 140   6      
 141   6      #endif // ä¸å¸¦æ ¡éªŒçš„ç‰ˆæœ¬
 142   6                          }
 143   5                          else if (ir_level_cnt <= 1200) // å°äº120000,120ms,è¯´æ˜æ¥æ”¶åˆ°äº†é‡å¤ç 
 144   5                          {
 145   6                              // if (ir_long_press_cnt < 65535)
 146   6                              //     ir_long_press_cnt++;
 147   6      
 148   6                              flag_is_recv_ir_repeat_code = 1;
 149   6                          }
 150   5                          // else // è¶…è¿‡120000,è¯´æ˜æ¥æ”¶åˆ°æ— æ•ˆçš„æ•°æ®
 151   5                          // {
 152   5                          // }
 153   5      
 154   5                          ir_level_cnt = 0;
 155   5                      }
 156   4      
 157   4                      last_level_in_ir_pin = 0; // è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ˜¯ä½ç”µå¹³
 158   4                  }
 159   3              } // çº¢å¤–è§£ç 
 160   2      #endif // çº¢å¤–è§£ç ã€éœ€è¦æ”¾åˆ°100usçš„å®šæ—¶å™¨ä¸­æ–­æ¥å¤„ç†ã€‘
 161   2      
 162   2      #if 1 // æ§åˆ¶LEDæŒ‡ç¤ºç¯ (è½¯ä»¶PWMé©±åŠ¨)
 163   2      
 164   2              {                   // æ§åˆ¶LEDæŒ‡ç¤ºç¯--éœ€è¦æ”¾åœ¨100usçš„ä¸­æ–­
 165   3                  static u16 cnt; // ç”¨è½¯ä»¶å®ç°PWMé©±åŠ¨LEDçš„ç›¸å…³å˜é‡
 166   3                  cnt++;
 167   3      
 168   3                  if (cnt <= 20) // 20 * 100us
 169   3                  {
 170   4                      if (flag_is_led_1_enable)
 171   4                      {
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 4   

 172   5                          LED_1_PIN = LED_ON_LEVEL;
 173   5                      }
 174   4      
 175   4                      if (flag_is_led_2_enable)
 176   4                      {
 177   5                          LED_2_PIN = LED_ON_LEVEL;
 178   5                      }
 179   4      
 180   4                      if (flag_is_led_3_enable)
 181   4                      {
 182   5                          LED_3_PIN = LED_ON_LEVEL;
 183   5                      }
 184   4      
 185   4                      if (flag_is_led_4_enable)
 186   4                      {
 187   5                          LED_4_PIN = LED_ON_LEVEL;
 188   5                      }
 189   4      
 190   4                      if (flag_is_led_5_enable)
 191   4                      {
 192   5                          LED_5_PIN = LED_ON_LEVEL;
 193   5                      }
 194   4                  }
 195   3                  else
 196   3                  {
 197   4                      LED_1_PIN = LED_OFF_LEVEL;
 198   4                      LED_2_PIN = LED_OFF_LEVEL;
 199   4                      LED_3_PIN = LED_OFF_LEVEL;
 200   4                      LED_4_PIN = LED_OFF_LEVEL;
 201   4                      LED_5_PIN = LED_OFF_LEVEL;
 202   4                  }
 203   3      
 204   3                  if (cnt >= 100) // 100 * 100us
 205   3                  {
 206   4                      cnt = 0;
 207   4                  }
 208   3      
 209   3              } // æ§åˆ¶LEDæŒ‡ç¤ºç¯--éœ€è¦æ”¾åœ¨100usçš„ä¸­æ–­
 210   2      
 211   2      #endif // æ§åˆ¶LEDæŒ‡ç¤ºç¯(è½¯ä»¶PWMé©±åŠ¨)
 212   2      
 213   2              {
 214   3                  static u8 cnt = 0;
 215   3                  static u8 blink_cnt = 0;
 216   3                  static bit flag_blink_dir = 0;
 217   3                  cnt++;
 218   3      
 219   3                  if (cnt >= 10) // 10 * 100us == 1ms
 220   3                  {
 221   4                      cnt = 0;
 222   4      
 223   4                      // {
 224   4                      //     static u16 cnt = 0;
 225   4                      //     cnt++;
 226   4                      //     if (cnt >= 1000)
 227   4                      //     {
 228   4                      //         cnt = 0;
 229   4                      //         // if (bat_adc_val > 100)
 230   4                      //         //     bat_adc_val -= 100;
 231   4      
 232   4                      //         if (bat_adc_val < 4095 - 100)
 233   4                      //         {
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 5   

 234   4                      //             bat_adc_val += 100;
 235   4                      //         }
 236   4                      //     }
 237   4                      // }
 238   4      
 239   4      #if 1 // æ§åˆ¶LEDæŒ‡ç¤ºç¯çš„é—ªçƒæ•ˆæœ
 240   4      
 241   4                      blink_cnt++;
 242   4                      if (blink_cnt >= 200)
 243   4                      {
 244   5                          blink_cnt = 0;
 245   5      
 246   5                          // å¤„äºåˆå§‹æ”¾ç”µæŒ¡ä½æŒ‡ç¤ºæ¨¡å¼ï¼Œæ‰è¿›å…¥
 247   5                          if (CUR_LED_MODE_INITIAL_DISCHARGE_GEAR == cur_led_mode)
 248   5                          {
 249   6                              if (0 == flag_blink_dir)
 250   6                              {
 251   7                                  switch (cur_initial_discharge_gear)
 252   7                                  {
 253   8                                  case 1:
 254   8                                      LED_1_ON();
 255   8                                      break;
 256   8                                  case 2:
 257   8                                      LED_2_ON();
 258   8                                      break;
 259   8                                  case 3:
 260   8                                      LED_3_ON();
 261   8                                      break;
 262   8                                  case 4:
 263   8                                      LED_4_ON();
 264   8                                      break;
 265   8                                  case 5:
 266   8                                      LED_5_ON();
 267   8                                      break;
 268   8                                  }
 269   7      
 270   7                                  flag_blink_dir = 1;
 271   7                              }
 272   6                              else
 273   6                              {
 274   7                                  switch (cur_initial_discharge_gear)
 275   7                                  {
 276   8                                  case 1:
 277   8                                      LED_1_OFF();
 278   8                                      break;
 279   8                                  case 2:
 280   8                                      LED_2_OFF();
 281   8                                      break;
 282   8                                  case 3:
 283   8                                      LED_3_OFF();
 284   8                                      break;
 285   8                                  case 4:
 286   8                                      LED_4_OFF();
 287   8                                      break;
 288   8                                  case 5:
 289   8                                      LED_5_OFF();
 290   8                                      break;
 291   8                                  }
 292   7      
 293   7                                  flag_blink_dir = 0;
 294   7                              }
 295   6                          } // if (CUR_LED_MODE_INITIAL_DISCHARGE_GEAR == cur_led_mode)
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 6   

 296   5                          // åˆšæŒ‰ä¸‹é¥æ§å™¨çš„ SET æŒ‰é”®ï¼Œä¼šè¿›å…¥ è®¾ç½®æ¨¡å¼ï¼Œ5ä¸ªæŒ‡ç¤ºç¯ä¸€èµ·é—ªç
             -ƒ
 297   5                          else if (CUR_LED_MODE_SETTING == cur_led_mode)
 298   5                          {
 299   6                              if (0 == flag_blink_dir)
 300   6                              {
 301   7                                  LED_1_ON();
 302   7                                  LED_2_ON();
 303   7                                  LED_3_ON();
 304   7                                  LED_4_ON();
 305   7                                  LED_5_ON();
 306   7                                  flag_blink_dir = 1;
 307   7                              }
 308   6                              else
 309   6                              {
 310   7                                  LED_1_OFF();
 311   7                                  LED_2_OFF();
 312   7                                  LED_3_OFF();
 313   7                                  LED_4_OFF();
 314   7                                  LED_5_OFF();
 315   7                                  flag_blink_dir = 0;
 316   7                              }
 317   6                          }
 318   5                          // æŒ‡ç¤ºç¯å¤„äºå……ç”µæŒ‡ç¤ºæ¨¡å¼
 319   5                          else if (CUR_LED_MODE_CHARGING == cur_led_mode)
 320   5                          {
 321   6                              if (cur_led_gear_in_charging <= 2)
 322   6                              {
 323   7                                  if (0 == flag_blink_dir)
 324   7                                  {
 325   8                                      LED_2_ON();
 326   8                                      flag_blink_dir = 1;
 327   8                                  }
 328   7                                  else
 329   7                                  {
 330   8                                      LED_2_OFF();
 331   8                                      flag_blink_dir = 0;
 332   8                                  }
 333   7                              }
 334   6                              else if (cur_led_gear_in_charging <= 3)
 335   6                              {
 336   7                                  if (0 == flag_blink_dir)
 337   7                                  {
 338   8                                      LED_3_ON();
 339   8                                      flag_blink_dir = 1;
 340   8                                  }
 341   7                                  else
 342   7                                  {
 343   8                                      LED_3_OFF();
 344   8                                      flag_blink_dir = 0;
 345   8                                  }
 346   7                              }
 347   6                              else if (cur_led_gear_in_charging <= 4)
 348   6                              {
 349   7                                  if (0 == flag_blink_dir)
 350   7                                  {
 351   8                                      LED_4_ON();
 352   8                                      flag_blink_dir = 1;
 353   8                                  }
 354   7                                  else
 355   7                                  {
 356   8                                      LED_4_OFF();
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 7   

 357   8                                      flag_blink_dir = 0;
 358   8                                  }
 359   7                              }
 360   6                              else if (cur_led_gear_in_charging <= 5)
 361   6                              {
 362   7                                  if (0 == flag_blink_dir)
 363   7                                  {
 364   8                                      LED_5_ON();
 365   8                                      flag_blink_dir = 1;
 366   8                                  }
 367   7                                  else
 368   7                                  {
 369   8                                      LED_5_OFF();
 370   8                                      flag_blink_dir = 0;
 371   8                                  }
 372   7                              }
 373   6                          }
 374   5      
 375   5                      } // if (blink_cnt >= 200)
 376   4      
 377   4      #endif // æ§åˆ¶LEDæŒ‡ç¤ºç¯çš„é—ªçƒæ•ˆæœ
 378   4      
 379   4      #if 1 // é€€å‡ºç‰¹æ®Šçš„ledæŒ‡ç¤ºæ¨¡å¼çš„æ—¶é—´è®¡æ•°
 380   4            // if (cur_led_mode != CUR_LED_MODE_BAT_INDICATOR) // ä¸å¤„äºç”µæ± ç”µé‡æŒ‡ç¤ºæ¨¡å¼ï¼Œå¼€å§‹ç´¯è
             -®¡æ—¶é—´
 381   4                      if (CUR_LED_MODE_INITIAL_DISCHARGE_GEAR == cur_led_mode ||
 382   4                          CUR_LED_MODE_DISCHARGE_RATE == cur_led_mode ||
 383   4                          CUR_LED_MODE_SETTING == cur_led_mode)
 384   4                      {
 385   5                          // special_led_mode_times_cnt++;
 386   5                          // if (special_led_mode_times_cnt >= 5000)
 387   5                          // {
 388   5                          //     special_led_mode_times_cnt = 0;
 389   5                          //     flag_led_exit_setting_times_come = 1;
 390   5                          // }
 391   5                          led_mode_setting_exit_times_cnt++;
 392   5                          if (led_mode_setting_exit_times_cnt >= 5000)
 393   5                          {
 394   6                              led_mode_setting_exit_times_cnt = 0;
 395   6                              flag_led_exit_setting_times_come = 1;
 396   6                          }
 397   5                      }
 398   4      #endif // é€€å‡ºç‰¹æ®Šçš„ledæŒ‡ç¤ºæ¨¡å¼çš„æ—¶é—´è®¡æ•°
 399   4      
 400   4                      {
 401   5                          static u8 cnt = 0;
 402   5                          // static u16 cnt = 0;
 403   5                          cnt++;
 404   5                          if (cnt >= 200)
 405   5                          // if (cnt >= 1000) // å»¶é•¿æ—¶é—´å¹¶ä¸ä¼šå½±å“ç”µæ± å¿«æ»¡ç”µåï¼Œè°ƒèŠ‚PWMçš„å¤§
             -å°ï¼Œè¿˜æ˜¯ä¼šè¿‡å†²ï¼Œç”µæµè¿‡å¤§
 406   5                          {
 407   6                              cnt = 0;
 408   6                              flag_is_charging_adjust_time_come = 1; // è°ƒèŠ‚å……ç”µç”µæµ/åŠŸç‡
 409   6                          }
 410   5                      }
 411   4      
 412   4      #if 1 // åœ¨æ¶“æµå……ç”µæ—¶ï¼Œè´Ÿè´£æ¯æ®µæ—¶é—´æ–­å¼€ä¸€ä¼šPWMè¾“å‡º
 413   4                      {
 414   5                          static u16 cnt = 0;
 415   5      
 416   5                          if (CUR_CHARGING_PWM_STATUS_LOW_FEQ == cur_charging_pwm_status)
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 8   

 417   5                          {
 418   6                              // å¦‚æœåœ¨æ¶“æµå……ç”µ
 419   6                              cnt++;
 420   6      
 421   6                              if (cnt < 22000) // 22 s
 422   6                              {
 423   7                                  timer1_pwm_enable();
 424   7                                  // flag_is_tim_turn_off_pwm = 0;
 425   7                              }
 426   6                              else if (cnt <= (22000 + 60)) // 22s + 60ms
 427   6                              {
 428   7                                  // ç´¯è®¡æ¶“æµå……ç”µ22såï¼Œå…³é—­æ§åˆ¶å……ç”µçš„PWMï¼Œä¹‹åå¯ä»¥åœ¨è¿™æœŸ
             -é—´æ£€æµ‹ç”µæ± æ˜¯å¦æ»¡ç”µ
 429   7                                  timer1_pwm_disable();
 430   7                                  // flag_is_tim_turn_off_pwm = 1;
 431   7                                  // cnt = 0;
 432   7                              }
 433   6                              else
 434   6                              {
 435   7                                  cnt = 0;
 436   7                              }
 437   6                          }
 438   5                          else
 439   5                          {
 440   6                              cnt = 0;
 441   6                          }
 442   5                      }
 443   4      #endif // åœ¨æ¶“æµå……ç”µæ—¶ï¼Œè´Ÿè´£æ¯æ®µæ—¶é—´æ–­å¼€ä¸€ä¼šPWMè¾“å‡º
 444   4      
 445   4                  } // if (cnt >= 10) // 10 * 100us == 1ms
 446   3              }
 447   2      
 448   2      #if 1 // æ”¾ç”µæ—¶é—´æ§åˆ¶
 449   2      
 450   2              // å¦‚æœä¸åœ¨å……ç”µï¼Œè®¾å¤‡æ²¡æœ‰å…³æœºï¼Œæ‰è¿›è¡Œæ”¾ç”µæ—¶é—´ç´¯è®¡
 451   2              {
 452   3                  static u16 cnt = 0;
 453   3                  if (CUR_CHARGE_PHASE_NONE == cur_charge_phase && /* å¦‚æœä¸åœ¨å……ç”µ */
 454   3                      cur_led_mode != CUR_LED_MODE_OFF)            /* å¦‚æœæŒ‡ç¤ºç¯æ²¡æœ‰å…³é—­ */
 455   3                  {
 456   4                      cnt++;
 457   4                      if (cnt >= 10000) // 10000 * 100usï¼Œ1s
 458   4                      {
 459   5                          cnt = 0;
 460   5                          // flag_is_light_adjust_time_come = 1;
 461   5      
 462   5                          if (light_adjust_time_cnt < 4294967295) // é˜²æ­¢è®¡æ•°æº¢å‡º
 463   5                          {
 464   6                              light_adjust_time_cnt++;
 465   6                          }
 466   5                      }
 467   4                  }
 468   3                  else
 469   3                  {
 470   4                      cnt = 0;
 471   4                  }
 472   3              }
 473   2      
 474   2      #endif // æ”¾ç”µæ—¶é—´æ§åˆ¶
 475   2      
 476   2      #if 1 // ç¼“æ…¢è°ƒèŠ‚é©±åŠ¨ç¯å…‰çš„pwmå ç©ºæ¯”
 477   2      
C51 COMPILER V9.60.7.0   TIMER0                                                            07/17/2025 14:33:58 PAGE 9   

 478   2              {
 479   3                  // static u16 cnt = 0;
 480   3      
 481   3                  if (CUR_CHARGE_PHASE_NONE == cur_charge_phase &&
 482   3                      cur_led_mode != CUR_LED_MODE_OFF)
 483   3                  {
 484   4      
 485   4                      if (cur_light_pwm_duty_val > expect_light_pwm_duty_val)
 486   4                      {
 487   5                          // å¦‚æœè¦è°ƒå°ç¯å…‰çš„å ç©ºæ¯”
 488   5                          cur_light_pwm_duty_val--;
 489   5                      }
 490   4                      else if (cur_light_pwm_duty_val < expect_light_pwm_duty_val)
 491   4                      {
 492   5                          // å¦‚æœè¦è°ƒå¤§ç¯å…‰çš„å ç©ºæ¯”
 493   5                          cur_light_pwm_duty_val++;
 494   5                      }
 495   4      
 496   4                      timer2_set_pwm_duty(cur_light_pwm_duty_val);
 497   4                  }
 498   3              }
 499   2      
 500   2      #endif // ç¼“æ…¢è°ƒèŠ‚é©±åŠ¨ç¯å…‰çš„pwmå ç©ºæ¯”
 501   2          }
 502   1      
 503   1          // é€€å‡ºä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
 504   1          __IRQnIPnPop(TMR0_IRQn);
 505   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1219    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     15    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
