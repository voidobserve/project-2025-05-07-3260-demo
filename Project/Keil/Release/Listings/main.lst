C51 COMPILER V9.60.7.0   MAIN                                                              06/25/2025 17:38:40 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Release\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\main.c OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) INCDIR(..\.
                    -.\Libraries\Include;..\..\User;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\main.lst) OBJECT(
                    -.\Release\Objects\main.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    main.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    01-05-2021
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2021 HUGE-IC</center></h2>
  12           *
  13           * °æÈ¨ËµÃ÷ºóÐø²¹ÉÏ
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          #include <stdio.h>
  21          
  22          #include "user_config.h"
  23          
  24          volatile bit_flag flag1 = {0};
  25          volatile bit_flag flag2 = {0};
  26          
  27          //
  28          void led_pin_config(void)
  29          {
  30   1          P1_MD0 &= ~GPIO_P11_MODE_SEL(0x03);
  31   1          P1_MD0 |= GPIO_P11_MODE_SEL(0x01);
  32   1          FOUT_S11 = GPIO_FOUT_AF_FUNC;
  33   1      
  34   1          P1_MD0 &= ~GPIO_P12_MODE_SEL(0x03);
  35   1          P1_MD0 |= GPIO_P12_MODE_SEL(0x01);
  36   1          FOUT_S12 = GPIO_FOUT_AF_FUNC;
  37   1      
  38   1          P1_MD0 &= ~GPIO_P13_MODE_SEL(0x03);
  39   1          P1_MD0 |= GPIO_P13_MODE_SEL(0x01);
  40   1          FOUT_S13 = GPIO_FOUT_AF_FUNC;
  41   1      
  42   1          P1_MD1 &= ~GPIO_P14_MODE_SEL(0x03);
  43   1          P1_MD1 |= GPIO_P14_MODE_SEL(0x01);
  44   1          FOUT_S14 = GPIO_FOUT_AF_FUNC;
  45   1      
  46   1          P1_MD1 &= ~GPIO_P15_MODE_SEL(0x03);
  47   1          P1_MD1 |= GPIO_P15_MODE_SEL(0x01);
  48   1          FOUT_S15 = GPIO_FOUT_AF_FUNC;
  49   1      }
  50          
  51          /**
  52           * @brief  Main program.
  53           * @param  None
C51 COMPILER V9.60.7.0   MAIN                                                              06/25/2025 17:38:40 PAGE 2   

  54           * @retval None
  55           */
  56          void main(void)
  57          {
  58   1          // ¿´ÃÅ¹·Ä¬ÈÏ´ò¿ª, ¸´Î»Ê±¼ä2s
  59   1          WDT_KEY = WDT_KEY_VAL(0xDD); //  ¹Ø±Õ¿´ÃÅ¹· (ÈçÐèÅäÖÃ¿´ÃÅ¹·Çë²é¿´¡°WDT\WDT_Reset¡±Ê¾Àý)
  60   1      
  61   1          system_init();
  62   1      
  63   1          // ¹Ø±ÕHCKºÍHDAµÄµ÷ÊÔ¹¦ÄÜ
  64   1          WDT_KEY = 0x55;  // ½â³ýÐ´±£»¤
  65   1          IO_MAP &= ~0x01; // Çå³ýÕâ¸ö¼Ä´æÆ÷µÄÖµ£¬ÊµÏÖ¹Ø±ÕHCKºÍHDAÒý½ÅµÄµ÷ÊÔ¹¦ÄÜ£¨½â³ýÓ³Éä£©
  66   1          WDT_KEY = 0xBB;  // Ð´Ò»¸öÎÞÐ§µÄÊý¾Ý£¬´¥·¢Ð´±£»¤
  67   1      
  68   1          uart0_config();
  69   1          timer0_config();
  70   1          timer1_pwm_config();
  71   1          timer1_pwm_disable();
  72   1      
  73   1          // timer1_set_pwm_high_feq();
  74   1          // TODO: 7361²»ÓÃ¼ÓÕâ¸öÒý½ÅÅäÖÃ:
  75   1          led_pin_config();
  76   1      
  77   1      
  78   1          adc_config();
  79   1      
  80   1          printf("sys reset\n");
  81   1      
  82   1          // adc_sel_pin(ADC_PIN_DETECT_CHARGE); // ²âÊÔÍ¨¹ý£¬¿ÉÒÔÕý³£¼ì²â¶ÔÓ¦µÄµçÑ¹Öµ
  83   1          // adc_sel_pin(ADC_PIN_DETECT_BATTERY); // ²âÊÔÍ¨¹ý£¬¿ÉÒÔÕý³£¼ì²â¶ÔÓ¦µÄµçÑ¹Öµ
  84   1      
  85   1          PWM_CTL_FOR_CHARGING_SET_HIGH_FEQ();
  86   1          // ÓÃÏÂÃæµÄÕ¼¿Õ±È³äµç£¬µçÁ÷»á·Ç³£´ó£º
  87   1          // TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 10 / 100) >> 8) & 0xFF; // 10%
  88   1          // TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 10 / 100) & 0xFF;
  89   1      
  90   1          // ÓÃÕâÒ»À¸³äµç£¨³äµçµçÑ¹5.5~32V£©£¬µçÔ´Ò»²àÏÔÊ¾²»³öµçÁ÷
  91   1          // PWM_CTL_FOR_CHARGING_SET_HIGH_FEQ();
  92   1          // TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 1 / 100) >> 8) & 0xFF; // 1%£¬Êµ¼Ê²âÊÔÓÐÊ±ÊÇ0.88%£¬ÓÐÊ±Ê
             -Ç1.3%
  93   1          // TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 1 / 100) & 0xFF;
  94   1          // TMR1_PWMH = 0 & 0xFF;
  95   1          // TMR1_PWML = 1 & 0xFF;
  96   1      
  97   1          // ³äµçµçÑ¹µ½ 7-8VÊ±£¬µçÁ÷¾Í»áµ½1A£¬µçÑ¹Ô½¸ß£¬µçÁ÷Ô½´ó
  98   1          // TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 5 / 100) >> 8) & 0xFF; // 5%
  99   1          // TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 5 / 100) & 0xFF;
 100   1      
 101   1          // ³äµçµçÑ¹µ½11.3VÊ±£¬µçÁ÷»áµ½1A£¬µçÑ¹Ô½¸ß£¬µçÁ÷Ô½´ó
 102   1          TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 2 / 100) >> 8) & 0xFF; // 2%
 103   1          TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 2 / 100) & 0xFF;
 104   1      
 105   1          // 5V£¬µçÁ÷»áµ½10A
 106   1          // TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 80 / 100) >> 8) & 0xFF; //
 107   1          // TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 80 / 100) & 0xFF;
 108   1      
 109   1          // ÔÚ5V¸½½ü£¬µçÁ÷5A×óÓÒ
 110   1          // TMR1_PWMH = ((TIMER1_HIGH_FEQ_PEROID_VAL * 60 / 100) >> 8) & 0xFF; //
 111   1          // TMR1_PWML = (TIMER1_HIGH_FEQ_PEROID_VAL * 60 / 100) & 0xFF;
 112   1      
 113   1          // {
 114   1          //     u32 tmp = (u32)TIMER1_HIGH_FEQ_PEROID_VAL * 90 / 100;
C51 COMPILER V9.60.7.0   MAIN                                                              06/25/2025 17:38:40 PAGE 3   

 115   1      
 116   1          //     TMR1_PWMH = (tmp >> 8) & 0xFF;
 117   1          //     TMR1_PWML = tmp & 0xFF;
 118   1          // }
 119   1      
 120   1          LED_1_ON();
 121   1          LED_2_ON();
 122   1          LED_3_ON();
 123   1          LED_4_ON();
 124   1          LED_5_ON();
 125   1      
 126   1          while (1)
 127   1          {
 128   2              // charge_handle();
 129   2          }
 130   1      }
 131          
 132          /**
 133           * @}
 134           */
 135          
 136          /*************************** (C) COPYRIGHT 2022 HUGE-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    135    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
