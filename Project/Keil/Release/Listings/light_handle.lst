C51 COMPILER V9.60.7.0   LIGHT_HANDLE                                                      07/16/2025 16:01:08 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LIGHT_HANDLE
OBJECT MODULE PLACED IN .\Release\Objects\light_handle.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\light_handle.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000
                    -C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\lig
                    -ht_handle.lst) OBJECT(.\Release\Objects\light_handle.obj)

line level    source

   1          // encoding UTF-8
   2          // ÁÅØÂÖâÊéßÂà∂Ê∫êÁ®ãÂ∫è
   3          #include "light_handle.h"
   4          
   5          void light_blink(void)
   6          {
   7   1          u8 i;
   8   1          for (i = 0; i < 3; i++)
   9   1          {
  10   2              LIGHT_ON();
  11   2              delay_ms(161);
  12   2              LIGHT_OFF();
  13   2              delay_ms(161);
  14   2          }
  15   1      }
  16          
  17           
  18          /**
  19           * @brief ÁÅØÂÖâÊéßÂà∂ÔºàÊîæÁîµÊéßÂà∂Ôºâ
  20           *          ËøõÂÖ•ÂâçË¶ÅÂÖàÁ°ÆËÆ§ expect_light_pwm_duty_val ÁöÑÂÄºÊòØÂê¶ÂàùÂßãÂåñËøá‰∏ÄÊ¨°Ôºå
  21           *          light_adjust_time_cntË∞ÉËäÇÁÅØÂÖâÁöÑÊó∂Èó¥ËÆ°Êó∂ÊòØÂê¶Ê≠£Á°ÆÔºåÂ¶ÇÊûúÂàáÊç¢‰∫ÜÊ®°ÂºèÊàñÊîæÁîµÈ
             -ÄüÂ∫¶ÔºåË¶ÅÂÖàÊ∏ÖÈõ∂
  22           */
  23          void light_handle(void)
  24          {
  25   1          // Â¶ÇÊûúÊ≠£Âú®ÂÖÖÁîµÔºåÁõ¥Êé•ËøîÂõû
  26   1      
  27   1          // Â¶ÇÊûúÊú™Âú®ÂÖÖÁîµ
  28   1      
  29   1          // if (flag_is_light_adjust_time_come)
  30   1          // {
  31   1          //     flag_is_light_adjust_time_come = 0;
  32   1          //     light_adjust_time_cnt++;
  33   1          // }
  34   1      
  35   1          if (1 == cur_discharge_rate) // ÊîæÁîµÈÄüÁéá1Ê°£ÔºåM1
  36   1          {
  37   2              /*
  38   2                  ÈÄüÂ∫¶‰∏∫M1Ôºå
  39   2                  1200sÂêéÂèòÂåñ‰∏ÄÊ¨°Âç†Á©∫ÊØîÔºå(1200 * 1)
  40   2                  3600sÂêéÂÜçÂèòÂåñ‰∏ÄÊ¨°Ôºå    (1200 * 3)
  41   2                  7200sÂêéÂÜçÂèòÂåñ‰∏ÄÊ¨°Ôºå    (1200 * 6)
  42   2                  ...
  43   2                  ÂÅáËÆæ‰πãÂêéÊòØÔºö
  44   2                  (1200 * 9)
  45   2                  (1200 * 12)
  46   2                  (1200 * 15)
  47   2                  ...
  48   2                  ÊØèÊ¨°ÂèòÂåñÁ∫¶10%Âç†Á©∫ÊØî
  49   2              */
  50   2      
  51   2              if (light_adjust_time_cnt >= (1200 * light_ctl_phase_in_rate_1)) // Â¶ÇÊûúÂà∞‰∫ÜË∞ÉËäÇÊó∂Èó¥
  52   2              {
C51 COMPILER V9.60.7.0   LIGHT_HANDLE                                                      07/16/2025 16:01:08 PAGE 2   

  53   3                  light_adjust_time_cnt = 0;
  54   3      
  55   3                  if (1 == light_ctl_phase_in_rate_1)
  56   3                  {
  57   4                      light_ctl_phase_in_rate_1 = 3;
  58   4                  }
  59   3                  else
  60   3                  {
  61   4                      light_ctl_phase_in_rate_1 += 3;
  62   4                  }
  63   3      
  64   3                  // ÂÆöÊó∂Âô®ÂØπÂ∫îÁöÑÈáçË£ÖËΩΩÂÄºÊúÄÂ§ßÂÄº ÂØπÂ∫î 100%Âç†Á©∫ÊØî
  65   3                  if (expect_light_pwm_duty_val >= ((u32)TIMER2_FEQ * 48 / 1000) + ((u32)TIMER2_FEQ * 10 / 100))
  66   3                  {
  67   4                      // Â¶ÇÊûú‰ªçÂ§ß‰∫é 4.8% + 10%Ôºå ÂáèÂ∞ë10%Âç†Á©∫ÊØî
  68   4                      expect_light_pwm_duty_val -= (u32)TIMER2_FEQ * 10 / 100;
  69   4                  }
  70   3                  else
  71   3                  {
  72   4                      // 4.8%Âç†Á©∫ÊØî
  73   4                      expect_light_pwm_duty_val = (u32)TIMER2_FEQ * 48 / 1000;
  74   4                  }
  75   3              }
  76   2          }
  77   1          else // 2 == cur_discharge_rate || 3 == cur_discharge_rate
  78   1          {
  79   2              /*
  80   2                  ‰∏ÄÂºÄÂßãÊØè40sÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
  81   2                  ‰ªé47%ÂºÄÂßãÔºåÊØè240sÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
  82   2                  ‰ªé42%ÂºÄÂßãÔºåÊØè420sÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
  83   2      
  84   2                  ÊöÇÂÆöÊØèÊ¨°Èôç‰Ωé 0.6%
  85   2              */
  86   2      
  87   2              // ÂΩìÂâçÁöÑÂç†Á©∫ÊØîÂú®47%‰ª•‰∏äÊó∂Ôºå‰∏çÂåÖÊã¨47%ÔºåÊØè40sÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
  88   2              if (cur_light_pwm_duty_val > (u32)TIMER2_FEQ * 47 / 100) 
  89   2              {
  90   3                  if (light_adjust_time_cnt >= 40)
  91   3                  {
  92   4                      light_adjust_time_cnt = 0;
  93   4      
  94   4                      if (expect_light_pwm_duty_val >= ((u32)TIMER2_FEQ * 48 / 1000) + ((u32)TIMER2_FEQ * 6 / 10
             -00))
  95   4                      {
  96   5                          // Â¶ÇÊûú‰ªçÂ§ß‰∫é 4.8% + xx %Ôºå ÂáèÂ∞ë xx %Âç†Á©∫ÊØî
  97   5                          expect_light_pwm_duty_val -= (u32)TIMER2_FEQ * 6 / 1000;
  98   5                      }
  99   4                      else
 100   4                      { 
 101   5                          // 4.8%Âç†Á©∫ÊØî
 102   5                          expect_light_pwm_duty_val = (u32)TIMER2_FEQ * 48 / 1000;
 103   5                      }
 104   4                  }
 105   3              }
 106   2              // ÂΩìÂâçÁöÑÂç†Á©∫ÊØîÂú®42%‰ª•‰∏äÊó∂Ôºå‰∏çÂåÖÊã¨42%ÔºåÊØè240ÁßíÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
 107   2              else if (cur_light_pwm_duty_val > (u32)TIMER2_FEQ * 42 / 100) 
 108   2              {
 109   3                  if (light_adjust_time_cnt >= 240)
 110   3                  {
 111   4                      light_adjust_time_cnt = 0;
 112   4      
 113   4                      if (expect_light_pwm_duty_val >= ((u32)TIMER2_FEQ * 48 / 1000) + ((u32)TIMER2_FEQ * 6 / 10
C51 COMPILER V9.60.7.0   LIGHT_HANDLE                                                      07/16/2025 16:01:08 PAGE 3   

             -00))
 114   4                      {
 115   5                          // Â¶ÇÊûú‰ªçÂ§ß‰∫é 4.8% + xx %Ôºå ÂáèÂ∞ë xx %Âç†Á©∫ÊØî
 116   5                          expect_light_pwm_duty_val -= (u32)TIMER2_FEQ * 6 / 1000;
 117   5                      }
 118   4                      else
 119   4                      { 
 120   5                          // 4.8%Âç†Á©∫ÊØî
 121   5                          expect_light_pwm_duty_val = (u32)TIMER2_FEQ * 48 / 1000;
 122   5                      }
 123   4                  }
 124   3              }
 125   2              else // ÂΩìÂâçÁöÑÂç†Á©∫ÊØîÂú®42%Âèä‰ª•‰∏ãÔºåÊØè420ÁßíÈôç‰Ωé‰∏ÄÊ¨°Âç†Á©∫ÊØî
 126   2              {
 127   3                  if (light_adjust_time_cnt >= 420)
 128   3                  {
 129   4                      light_adjust_time_cnt = 0;
 130   4      
 131   4                      if (expect_light_pwm_duty_val >= ((u32)TIMER2_FEQ * 48 / 1000) + ((u32)TIMER2_FEQ * 6 / 10
             -00))
 132   4                      {
 133   5                          // Â¶ÇÊûú‰ªçÂ§ß‰∫é 4.8% + xx %Ôºå ÂáèÂ∞ë xx %Âç†Á©∫ÊØî
 134   5                          expect_light_pwm_duty_val -= (u32)TIMER2_FEQ * 6 / 1000;
 135   5                      }
 136   4                      else
 137   4                      { 
 138   5                          // 4.8%Âç†Á©∫ÊØî
 139   5                          expect_light_pwm_duty_val = (u32)TIMER2_FEQ * 48 / 1000;
 140   5                      }
 141   4                  }
 142   3              }
 143   2          }
 144   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    418    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
