C51 COMPILER V9.60.7.0   IR_HANDLE                                                         07/17/2025 14:33:58 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IR_HANDLE
OBJECT MODULE PLACED IN .\Release\Objects\ir_handle.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\ir_handle.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\ir_han
                    -dle.lst) OBJECT(.\Release\Objects\ir_handle.obj)

line level    source

   1          #include "ir_handle.h"
   2          #include "user_config.h"
   3          
   4          volatile u8 ir_data = 0;
   5          volatile bit flag_is_recv_ir_repeat_code = 0;
   6          volatile bit flag_is_recved_data = 0;
   7          
   8          
   9          
  10          
  11          
  12          /*
  13              set_led_mode
  14          
  15              CUR_LED_MODE_BAT_INDICATOR = 0,      // ç”µæ± ç”µé‡æŒ‡ç¤ºæ¨¡å¼
  16              CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, // åˆå§‹æ”¾ç”µæŒ¡ä½ -- ä» xx% PWWå¼€å§‹æ”¾ç”µ
  17              CUR_LED_MODE_DISCHARGE_RATE,         // æ”¾ç”µé€Ÿç‡
  18          */
  19          
  20          /**
  21           * @brief åœ¨è®¾ç½®æ¨¡å¼ï¼Œè®¾ç½®åˆå§‹æ”¾ç”µæŒ¡ä½æˆ–æ”¾ç”µé€Ÿç‡
  22           *          å‡½æ•°å†…éƒ¨ä¼šåˆ¤æ–­ å½“å‰ æ˜¯å¦å¤„äºè®¾ç½®æ¨¡å¼
  23           *
  24           * @param set_led_mode
  25           *          CUR_LED_MODE_INITIAL_DISCHARGE_GEAR è¦è®¾ç½®çš„æ˜¯åˆå§‹æ”¾ç”µæŒ¡ä½
  26           *          CUR_LED_MODE_DISCHARGE_RATE     è¦è®¾ç½®çš„æ˜¯æ”¾ç”µé€Ÿç‡
  27           * @param val åˆå§‹æ”¾ç”µæŒ¡ä½ æˆ– æ”¾ç”µé€Ÿç‡å¯¹åº”çš„å€¼ï¼ˆéœ€è¦æ³¨æ„ä¸èƒ½è¶…è¿‡èŒƒå›´ï¼‰
  28           */
  29          void set_led_mode_status(u8 set_led_mode, u8 val)
  30          {
  31   1          // å¦‚æœåœ¨è®¾ç½®æ¨¡å¼ï¼Œæ‰ä¼šè¿›å…¥
  32   1          if (flag_is_in_setting_mode)
  33   1          {
  34   2              if (CUR_LED_MODE_INITIAL_DISCHARGE_GEAR == set_led_mode)
  35   2              {
  36   3                  cur_initial_discharge_gear = val;
  37   3              }
  38   2              else // CUR_LED_MODE_DISCHARGE_RATE == set_led_mode
  39   2              {
  40   3                  cur_discharge_rate = val;
  41   3              }
  42   2      
  43   2              cur_led_mode = set_led_mode;
  44   2              led_status_refresh();
  45   2          }
  46   1      }
  47          
  48          void ir_handle(void)
  49          {
  50   1          static u8 last_ir_data = 0;
  51   1      
  52   1          if (cur_charge_phase != CUR_CHARGE_PHASE_NONE)
  53   1          {
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         07/17/2025 14:33:58 PAGE 2   

  54   2              // å¦‚æœå½“å‰æ­£åœ¨å……ç”µï¼Œç›´æ¥è¿”å›
  55   2              flag_is_recved_data = 0;
  56   2              flag_is_recv_ir_repeat_code = 0;
  57   2              last_ir_data = 0;
  58   2              return;
  59   2          }
  60   1      
  61   1          if (flag_is_recved_data)
  62   1          {
  63   2              flag_is_recved_data = 0;
  64   2      
  65   2              last_ir_data = ir_data;
  66   2      
  67   2              switch (ir_data)
  68   2              {
  69   3              case IR_KEY_RED:
  70   3                  // å¤§æ‘‡æ§å™¨çš„çº¢è‰²æŒ‰é”®ï¼Œå°é¥æ§å™¨çš„ç»¿è‰²æŒ‰é”®
  71   3      
  72   3                  if (flag_is_in_setting_mode)
  73   3                  {
  74   4                      // æ­£å¤„äºè®¾ç½®æ¨¡å¼ï¼Œä¸å“åº”
  75   4                      return;
  76   4                  }
  77   3      
  78   3                  led_status_refresh();
  79   3      
  80   3                  /*
  81   3                      ä¸åœ¨è®¾ç½®æ¨¡å¼ï¼Œæ¯æ¬¡æŒ‰ä¸‹æŒ‰é”®ï¼Œåœ¨
  82   3                      ç”µæ± ç”µé‡æŒ‡ç¤º -> åˆå§‹æ”¾ç”µæŒ¡ä½ -> æ”¾ç”µé€Ÿç‡ -> ç”µæ± ç”µé‡æŒ‡ç¤º ä¹‹é—´åˆ‡æ
             -¢
  83   3                  */
  84   3                  cur_led_mode++;
  85   3                  if (cur_led_mode > CUR_LED_MODE_DISCHARGE_RATE)
  86   3                  {
  87   4                      cur_led_mode = CUR_LED_MODE_BAT_INDICATOR;
  88   4                  }
  89   3      
  90   3                  break;
  91   3      
  92   3              case IR_KEY_NUM_1:
  93   3                  // æ•°å­—1
  94   3      
  95   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, 1);
  96   3      
  97   3                  break;
  98   3      
  99   3              case IR_KEY_BRIGHTNESS_SUB_OR_NUM_2:
 100   3                  // äº®åº¦å‡ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—2
 101   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 102   3      
 103   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, 2);
 104   3      
 105   3                  break;
 106   3      
 107   3              case IR_KEY_3H_OR_NUM_3:
 108   3                  // 3Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—3
 109   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 110   3      
 111   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, 3);
 112   3      
 113   3                  break;
 114   3      
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         07/17/2025 14:33:58 PAGE 3   

 115   3              case IR_KEY_BRIGHTNESS_ADD_OR_NUM_4:
 116   3                  // äº®åº¦åŠ ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—4
 117   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 118   3      
 119   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, 4);
 120   3      
 121   3                  break;
 122   3      
 123   3              case IR_KEY_AUTO_OR_NUM_5:
 124   3                  // è‡ªåŠ¨æ¨¡å¼ ï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„æ•°å­—5
 125   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 126   3      
 127   3                  set_led_mode_status(CUR_LED_MODE_INITIAL_DISCHARGE_GEAR, 5);
 128   3      
 129   3                  break;
 130   3      
 131   3              case IR_KEY_5H_OR_M1:
 132   3                  // 5Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„M1
 133   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 134   3      
 135   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE, 1);
 136   3      
 137   3                  break;
 138   3      
 139   3              case IR_KEY_M2:
 140   3                  // å°é¥æ§å™¨çš„M2
 141   3      
 142   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE, 2);
 143   3      
 144   3                  break;
 145   3      
 146   3              case IR_KEY_8H_OR_M3:
 147   3                  // 8Hï¼Œä¹Ÿæ˜¯å°é¥æ§å™¨çš„M3
 148   3                  // TODOï¼šå¾…å®Œå–„åŠŸèƒ½
 149   3      
 150   3                  set_led_mode_status(CUR_LED_MODE_DISCHARGE_RATE, 3);
 151   3      
 152   3                  break;
 153   3      
 154   3              case IR_KEY_SET:
 155   3                  // SET æ¨¡å¼è®¾ç½®
 156   3      
 157   3                  flag_is_in_setting_mode = 1; // è¡¨ç¤ºè¿›å…¥è®¾ç½®æ¨¡å¼
 158   3                  led_status_refresh();
 159   3                  cur_led_mode = CUR_LED_MODE_SETTING; // äº¤ç»™å®šæ—¶å™¨å¤„ç†ï¼Œè®©æ‰€æœ‰æŒ‡ç¤ºç¯éƒ½é—ªçƒ
 160   3      
 161   3                  break;
 162   3      
 163   3              case IR_KEY_ON:
 164   3                  // å¼€ç¯
 165   3      
 166   3                  light_init();
 167   3                  // led_status_refresh(); 
 168   3                  // cur_led_mode = CUR_LED_MODE_BAT_INDICATOR;
 169   3                  led_mode_alter(CUR_LED_MODE_BAT_INDICATOR);
 170   3      
 171   3                  break;
 172   3      
 173   3              case IR_KEY_OFF:
 174   3      
 175   3                  // TODO: å¦‚æœæœªå…³æœº
 176   3                  if (expect_light_pwm_duty_val > 0 &&           /* å¦‚æœç¯å…‰è¿˜æ˜¯äº®çš„ */
C51 COMPILER V9.60.7.0   IR_HANDLE                                                         07/17/2025 14:33:58 PAGE 4   

 177   3                      CUR_CHARGE_PHASE_NONE == cur_charge_phase) /* å½“å‰æœªåœ¨å……ç”µ */
 178   3                  {
 179   4                      light_blink();
 180   4                      // LIGHT_OFF() // light_blink() æœ€åå°±æ˜¯å…³ç¯æ“ä½œï¼Œå¯ä»¥ä¸å†™è¿™ä¸€å¥
 181   4                      expect_light_pwm_duty_val = 0;
 182   4                      cur_light_pwm_duty_val = 0;
 183   4                      timer2_set_pwm_duty(0);
 184   4                      LIGHT_OFF();
 185   4                      cur_led_mode = CUR_LED_MODE_OFF;
 186   4                  }
 187   3      
 188   3                  break;
 189   3      
 190   3              } // switch (ir_data)
 191   2          } // if (flag_is_recved_data)
 192   1      
 193   1          if (flag_is_recv_ir_repeat_code)
 194   1          {
 195   2              flag_is_recv_ir_repeat_code = 0;
 196   2          }
 197   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    253    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
